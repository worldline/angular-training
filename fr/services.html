<!DOCTYPE html>
<html lang="fr-FR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.60">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="logo.png"><meta name="theme-color" content="#8514F5"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><title>Services | Formation Angular</title><meta name="description" content="Support de formation Angular">
    <link rel="stylesheet" href="/angular-training/assets/css/styles.d4c6a8a0.css">
    <link rel="preload" href="/angular-training/assets/js/runtime~app.a825557b.js" as="script"><link rel="preload" href="/angular-training/assets/css/styles.d4c6a8a0.css" as="style"><link rel="preload" href="/angular-training/assets/js/966.6bc1d20f.js" as="script"><link rel="preload" href="/angular-training/assets/js/app.2146f142.js" as="script"><link rel="preload" href="/angular-training/assets/js/v-41615831.c02b75ba.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-47a172f9.291bf16d.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-406818d6.121aa16d.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-7c58cd95.88b1841b.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-335946b2.0a9b9405.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-43e14fc6.215e05d9.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-0b5ef6ea.c8cafacc.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-06867140.fc4ed588.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-0f3c5d64.2f8c6ae0.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-04259cc7.31930dc5.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-7ba3cfc0.c87d4cf7.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-56a51099.e44197e4.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-66e9a7bd.d030d97c.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-76b3265c.57617f1a.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-dcd2f7ce.4327d6ae.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-4de770d4.688623d8.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-9f781948.3185612a.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-409dd4d7.206b4a5f.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-2f91e384.08bd7d0b.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-4a251b7e.f39af1e0.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-40885816.ed77776b.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-5753ab72.67971a99.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-7d1f12dc.2220acb2.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-a7994716.0eac4074.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-00a299a3.bc486f42.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-29b14426.ecbd918e.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-2d0a8b4a.e5989778.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-8daa1a0e.642f4708.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/783.d3c36333.js" as="script"><link rel="prefetch" href="/angular-training/assets/js/v-3706649a.39bfcd51.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/angular-training/fr/" class=""><!----><span class="site-name can-hide">Formation Angular</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Langue</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Langue</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/angular-training/" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/angular-training/fr/services.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Langue</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Langue</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/angular-training/" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/angular-training/fr/services.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/angular-training/fr/presentation.html" class="sidebar-item sidebar-heading" aria-label="Présentation d&#39;Angular"><!--[--><!--]--> Présentation d&#39;Angular <!--[--><!--]--></a><!----></li><li><a href="/angular-training/fr/typescript.html" class="sidebar-item sidebar-heading" aria-label="TypeScript"><!--[--><!--]--> TypeScript <!--[--><!--]--></a><!----></li><li><a href="/angular-training/fr/tooling.html" class="sidebar-item sidebar-heading" aria-label="Outillage"><!--[--><!--]--> Outillage <!--[--><!--]--></a><!----></li><li><a href="/angular-training/fr/first-steps.html" class="sidebar-item sidebar-heading" aria-label="Premiers pas"><!--[--><!--]--> Premiers pas <!--[--><!--]--></a><!----></li><li><a href="/angular-training/fr/template.html" class="sidebar-item sidebar-heading" aria-label="Dynamisez votre HTML"><!--[--><!--]--> Dynamisez votre HTML <!--[--><!--]--></a><!----></li><li><a href="/angular-training/fr/pipes.html" class="sidebar-item sidebar-heading" aria-label="Pipes"><!--[--><!--]--> Pipes <!--[--><!--]--></a><!----></li><li><a href="/angular-training/fr/components.html" class="sidebar-item sidebar-heading" aria-label="Composants"><!--[--><!--]--> Composants <!--[--><!--]--></a><!----></li><li><a href="/angular-training/fr/routing.html" class="sidebar-item sidebar-heading" aria-label="Routage"><!--[--><!--]--> Routage <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/angular-training/fr/services.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="Services"><!--[--><!--]--> Services <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/angular-training/fr/services.html#dependency-injection" class="router-link-active router-link-exact-active sidebar-item" aria-label="Dependency Injection"><!--[--><!--]--> Dependency Injection <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/angular-training/fr/services.html#tp-gestion-de-l-etat" class="router-link-active router-link-exact-active sidebar-item" aria-label="TP : Gestion de l&#39;État"><!--[--><!--]--> TP : Gestion de l&#39;État <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/angular-training/fr/services.html#le-httpclient" class="router-link-active router-link-exact-active sidebar-item" aria-label="Le HttpClient"><!--[--><!--]--> Le HttpClient <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/angular-training/fr/services.html#tp-appeler-un-backend" class="router-link-active router-link-exact-active sidebar-item" aria-label="TP : Appeler un backend"><!--[--><!--]--> TP : Appeler un backend <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/angular-training/fr/services.html#aller-plus-loin-httpresource" class="router-link-active router-link-exact-active sidebar-item" aria-label="Aller plus loin : HttpResource"><!--[--><!--]--> Aller plus loin : HttpResource <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/angular-training/fr/rxjs.html" class="sidebar-item sidebar-heading" aria-label="RxJS"><!--[--><!--]--> RxJS <!--[--><!--]--></a><!----></li><li><a href="/angular-training/fr/forms.html" class="sidebar-item sidebar-heading" aria-label="Formulaires"><!--[--><!--]--> Formulaires <!--[--><!--]--></a><!----></li><li><a href="/angular-training/fr/to-go-further.html" class="sidebar-item sidebar-heading" aria-label="Pour aller plus loin"><!--[--><!--]--> Pour aller plus loin <!--[--><!--]--></a><!----></li><li><a href="/angular-training/fr/ecosystem.html" class="sidebar-item sidebar-heading" aria-label="Écosystème d&#39;Angular"><!--[--><!--]--> Écosystème d&#39;Angular <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="services" tabindex="-1"><a class="header-anchor" href="#services" aria-hidden="true">#</a> Services</h1><p>Avec les composants et les directives, les services sont l&#39;un des principaux blocs de construction d&#39;une application Angular.</p><p>La seule préoccupation d&#39;un composant devrait être d&#39;afficher des données et non de les gérer. Les services sont là où l&#39;équipe Angular préconise de placer la logique métier et la gestion des données de l&#39;application. Avoir une séparation claire entre la couche de présentation et les autres traitements de l&#39;application augmente la réutilisabilité et la modularité.</p><p>La création d&#39;un service avec le CLI se fait comme suit :</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>ng generate <span class="token function">service</span> services/example
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Cela créera le service et sa classe de test associée dans le dossier <code>app/services</code>. Il est courant de placer les services dans un dossier de services, le CLI créera le dossier s&#39;il n&#39;existe pas déjà.</p><p>Le contenu suivant est généré automatiquement dans le fichier <code>example.service.ts</code> :</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@angular/core&#39;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providedIn<span class="token operator">:</span> <span class="token string">&#39;root&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ExampleService</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Lorsqu&#39;un composant nécessite un service, le service doit être injecté de la manière suivante :</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@angular/core&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ExampleService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;app/services/example.service&#39;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">&#39;app-example&#39;</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">&#39;./example.component.html&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ExampleComponent</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> exampleService <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>ExampleService<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Déclarez toujours une dépendance à un service comme privée. En effet le template ne devrait jamais accéder directement à un service mais toujours passer par une propriété ou une méthode exposée par la classe composant.</p></div><h2 id="dependency-injection" tabindex="-1"><a class="header-anchor" href="#dependency-injection" aria-hidden="true">#</a> Dependency Injection</h2><p>Dans le chapitre précédent, nous avons injecté des services fournis par la librairie <code>@angular/router</code> dans les composants qui en ont besoin. Si vous êtes familier avec Spring, vous n&#39;y avez peut-être pas beaucoup réfléchi car c&#39;est l&#39;un des mécanismes du framework.</p><p>Au démarrage, Angular crée un injecteur à l&#39;échelle de l&#39;application. Si d&#39;autres injecteurs sont nécessaires, Angular les créera en cours de route. L&#39;injecteur crée des dépendances (le plus souvent sous forme de services) et maintient un conteneur d&#39;instances de dépendances qu&#39;il réutilise si possible. L&#39;injecteur obtient les informations sur la façon de créer ou de récupérer une dépendance auprès d&#39;un fournisseur (provider). Un service agit généralement comme son propre fournisseur.</p><p>Vous ne l&#39;avez peut-être pas réalisé, mais nous avons déjà fait appel à des fournisseurs. Dans le chapitre sur les pipes, pour utiliser le <code>UpperCasePipe</code> dans la classe du composant plutôt que dans le template, nous l&#39;avons ajouté au tableau des providers du composant.</p><p>Lorsque Angular découvre qu&#39;un composant dépend d&#39;un service, il vérifie d&#39;abord si l&#39;injecteur a une instance existante de ce service. Si une instance du service demandé n&#39;existe pas encore, l&#39;injecteur en crée une à l&#39;aide du provider enregistré et l&#39;ajoute à l&#39;injecteur avant de renvoyer le service à Angular. Lorsque tous les services demandés ont été résolus et renvoyés, Angular peut instancié le composant avec ces services.</p><p>Les dépendances peuvent être fournies à trois niveaux :</p><ul><li><strong>au niveau root:</strong> c&#39;est le comportement par défaut lors de la création d&#39;un service avec le CLI. C&#39;est ce que signifie <code>providedIn: &#39;root&#39;</code>. La <em>même instance</em> de la dépendance est injectée partout où elle est nécessaire comme s&#39;il s&#39;agissait d&#39;un singleton.</li><li><strong>au niveau de la route:</strong> la dépendance est ajoutée au tableau de providers de la <code>Route</code>. La route et ses enfants obtiennent leur propre instance de la dépendance</li><li><strong>au niveau du composant:</strong> la dépendance est ajoutée au tableau des providers du composant. Chaque instance de ce composant obtient sa propre instance de la dépendance.</li></ul><h2 id="tp-gestion-de-l-etat" tabindex="-1"><a class="header-anchor" href="#tp-gestion-de-l-etat" aria-hidden="true">#</a> TP : Gestion de l&#39;État</h2><ol><li>Générez un <code>AuthenticationService</code> avec le CLI dans le dossier <code>app/services</code></li><li>Déplacez la logique du <code>loggedIn</code> du composant <code>App</code> vers le service</li><li>Injectez le service dans le <code>LoginFormComponent</code> et utilisez-le.</li><li>Implémentez une méthode de déconnexion dans le service d&#39;authentification et ajoutez un bouton de déconnexion dans le composant <code>App</code> qui l&#39;appelle et provoque une navigation vers le <code>LoginFormComponent</code>. Voici l&#39;html et le css :</li></ol><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">app.html</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">app.scss</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>logout<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Logout<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>router-outlet</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>router-outlet</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-scss line-numbers-mode" data-ext="scss"><pre class="language-scss"><code><span class="token selector">.logout </span><span class="token punctuation">{</span>
  <span class="token property">align-self</span><span class="token punctuation">:</span> end<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><ol start="5"><li>Afficher conditionnellement le bouton Logout en fonction du statut <code>loggedIn</code> de l&#39;utilisateur. Exposez le signal du <code>AuthenticationService</code> dans le fichier <code>app.ts</code> pour passer l&#39;information du service au template (c&#39;est une bonne pratique que de toujours déclarer un service comme private dans la classe d&#39;un composant donc vous aurez besoin d&#39;une variable dans le composant).</li><li>Utilisez un navigation guard pour rediriger l&#39;utilisateur qui souhaite accéder à la page de recherche de films vers <code>/login</code> s&#39;il n&#39;est pas authentifié (rendez la CanActivateFn vrai si la route est accessible sinon retournez un <code>UrlTree</code> via la méthode <code>createUrlTree</code> du service <code>Router</code>). Pour prendre en considération des cas d&#39;usage futur, ajoutez un returnUrl en tant que queryParam au <code>UrlTree</code> renvoyé afin que le <code>LoginFormComponent</code> sache où revenir après l&#39;authentification et modifiez le <code>LoginFormComponent</code> en conséquence. Pour générer le navigation guard, utilisez la commande du CLI suivante :</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>ng generate guard guards/authentication
<span class="token comment"># ? Which interfaces would you like to implement? CanActivate</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><details class="custom-container details"><summary>Aide pour injecter un service dans la fonction guard</summary><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> authenticationGuard<span class="token operator">:</span> <span class="token function-variable function">CanActivateFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span>route<span class="token punctuation">,</span> state<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> authenticationService <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>AuthenticationService<span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><details class="custom-container details"><summary>Aide pour l&#39;UrlTree</summary><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token function">inject</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createUrlTree</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;/login&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> queryParams<span class="token operator">:</span> <span class="token punctuation">{</span> returnUrl<span class="token operator">:</span> state<span class="token punctuation">.</span>url <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></details><details class="custom-container details"><summary>Résultat attendu</summary><p><img src="/angular-training/assets/img/visual-6a.b5c6adb8.png" alt="Résultat visuel du TP services"></p><p><img src="/angular-training/assets/img/visual-6.506c9e0c.png" alt="Résultat visuel du TP services"></p></details><h2 id="le-httpclient" tabindex="-1"><a class="header-anchor" href="#le-httpclient" aria-hidden="true">#</a> Le HttpClient</h2><p>Dans une Single Page Application (SPA), la communication avec le serveur se fait via des requêtes HTTP asynchrones (AJAX) ou des protocoles plus spécialisés tels que WebSocket. Nous allons voir comment faire ces requêtes réseau depuis une application Angular.</p><p>Angular fournit un module, le <code>HttpClientModule</code>, pour effectuer des appels HTTP. Le module fournit un service injectable, le <code>HttpClient</code>, pour faire des requêtes GET, POST, PATCH, DELETE et PUT. Pour injecter le <code>HttpClient</code> dans un service, ajoutez d&#39;abord le <code>HttpClientModule</code> au tableau de <code>providers</code> de l&#39;application dans le fichier <code>app.config.ts</code> en lui passant la fonction <code>provideHttpClient()</code>.</p><p>Voici quelques exemples:</p><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">Service</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">Component</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Injectable<span class="token punctuation">,</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@angular/core&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> HttpClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@angular/common/http&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Observable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;rxjs&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;app/models/user/user&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserCreation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;app/models/user/user-creation&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserEdition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;app/models/user/user-edition&#39;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Injectable</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  providedIn<span class="token operator">:</span> <span class="token string">&#39;root&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> httpClient <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>HttpClient<span class="token punctuation">)</span>

  <span class="token keyword">private</span> <span class="token keyword">readonly</span> baseUrl <span class="token operator">=</span> <span class="token string">&#39;api/backoffice/users&#39;</span>

  <span class="token function">create</span><span class="token punctuation">(</span>user<span class="token operator">:</span> UserCreation<span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>httpClient<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span>User<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>baseUrl<span class="token punctuation">,</span> user<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">update</span><span class="token punctuation">(</span>ref<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> user<span class="token operator">:</span> UserEdition<span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>httpClient<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">put</span><span class="token generic class-name"><span class="token operator">&lt;</span>User<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>baseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ref<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> user<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">getByUserReference</span><span class="token punctuation">(</span>ref<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>User<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>httpClient<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span>User<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>baseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ref<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> Component<span class="token punctuation">,</span> inject<span class="token punctuation">,</span> signal <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@angular/core&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;app/models/user/user&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> UserService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;app/services/user.service&#39;</span>

<span class="token decorator"><span class="token at operator">@</span><span class="token function">Component</span></span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  selector<span class="token operator">:</span> <span class="token string">&#39;app-user&#39;</span><span class="token punctuation">,</span>
  templateUrl<span class="token operator">:</span> <span class="token string">&#39;./user.component.html&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserComponent</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">readonly</span> userService <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>UserService<span class="token punctuation">)</span>

  <span class="token keyword">protected</span> <span class="token keyword">readonly</span> user <span class="token operator">=</span> <span class="token generic-function"><span class="token function">signal</span><span class="token generic class-name"><span class="token operator">&lt;</span>User <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span>
  <span class="token keyword">protected</span> reference <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>

  <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>userService<span class="token punctuation">.</span><span class="token function">getByUserReference</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reference<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>user <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>Les méthodes du service <code>HttpClient</code> renvoient des Observables. Ils seront traités dans le prochain chapitre sur la librairie RxJS. Un Observable n&#39;est exécuté qu&#39;une fois souscrit via la méthode <code>subscribe</code>. La méthode subscribe s&#39;attend à ce qu&#39;au moins une callback lui soit passé. La callback est le plus souvent fournie sous forme d&#39;une fonction flèche (arrow function).</p><h2 id="tp-appeler-un-backend" tabindex="-1"><a class="header-anchor" href="#tp-appeler-un-backend" aria-hidden="true">#</a> TP : Appeler un backend</h2><p>Nous utiliserons une API (le <em>backend</em>) pour authentifier les utilisateurs et rechercher des films. Ce backend a déjà été développé et peut être déployé localement en utilisant les lignes de commande suivantes (cloner le repo dans votre dossier de dépôts git habituel):</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">git</span> clone https://github.com/worldline/vuejs-training-backend.git
<span class="token builtin class-name">cd</span> vuejs-training-backend
<span class="token function">npm</span> <span class="token function">install</span>
<span class="token function">npm</span> start
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>La commande <code>npm start</code> vous demandera une clé d&#39;API. Attendez que votre instructeur vous la donne ou vous pouvez en générer une <a href="https://www.omdbapi.com/apikey.aspx?__EVENTTARGET=freeAcct&amp;__EVENTARGUMENT=&amp;__LASTFOCUS=&amp;__VIEWSTATE=%2FwEPDwUKLTIwNDY4MTIzNQ9kFgYCAQ9kFgICBw8WAh4HVmlzaWJsZWhkAgIPFgIfAGhkAgMPFgIfAGhkGAEFHl9fQ29udHJvbHNSZXF1aXJlUG9zdEJhY2tLZXlfXxYDBQtwYXRyZW9uQWNjdAUIZnJlZUFjY3QFCGZyZWVBY2N0oCxKYG7xaZwy2ktIrVmWGdWzxj%2FDhHQaAqqFYTiRTDE%3D&amp;__VIEWSTATEGENERATOR=5E550F58&amp;__EVENTVALIDATION=%2FwEdAAU%2BO86JjTqdg0yhuGR2tBukmSzhXfnlWWVdWIamVouVTzfZJuQDpLVS6HZFWq5fYpioiDjxFjSdCQfbG0SWduXFd8BcWGH1ot0k0SO7CfuulHLL4j%2B3qCcW3ReXhfb4KKsSs3zlQ%2B48KY6Qzm7wzZbR&amp;at=freeAcct&amp;Email=" target="_blank" rel="noopener noreferrer">ici<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>Le contrat d&#39;interface backend est disponible ici : <a href="http://localhost:3030/api-docs" target="_blank" rel="noopener noreferrer">api-docs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><ol><li>Ajoutez au dossier <code>src</code> le fichier <code>proxy.conf.json</code>.</li></ol><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">proxy.conf.json</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;/api/**&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:3030&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;changeOrigin&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;pathRewrite&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;^/api&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>Le proxy détournera tous les appels à l&#39;URL commençant par http://localhost:4200/api vers le serveur disponible à l&#39;adresse http://localhost:3030. Cela garantit également que nous ne rencontrerons aucun problème lié aux CORS (dans le cas où le backend ne serait hébergé en local). Cette configuration concerne uniquement le serveur de développement webpack ou vite fourni par le CLI pour exécuter l&#39;application sur votre machine dans un environnement de développement. Ce ne sera pas la configuration utilisée en production.</p><ol start="2"><li>Dans le fichier de configuration CLI - <code>angular.json</code> - ajoutez l&#39;option <code>proxyConfig</code> à la target serve :</li></ol><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code>...
<span class="token property">&quot;serve&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;builder&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@angular/build:dev-server&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;options&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;proxyConfig&quot;</span><span class="token operator">:</span> <span class="token string">&quot;src/proxy.conf.json&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;configurations&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    ...
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
...
</code></pre><div class="highlight-lines"><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Redémarrez le projet comme la configuration du CLI a changé (<code>angular.json</code>).</p><ol start="3"><li><p>Ajoutez <code>provideHttpClient()</code> au tableau de <code>providers</code> de l&#39;object <code>appConfig</code> dans le fichier <code>app.config.ts</code>.</p></li><li><p>Créez les interfaces/classes pour les modèles utilisés par le backend, ajoutez un fichier par modèle dans le dossier <code>models/authentication</code> :</p></li></ol><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">registration-request.ts</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">login-request.ts</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">user-response.ts</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">user.ts</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">RegistrationRequest</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">public</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token keyword">public</span> password<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token keyword">public</span> firstname<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token keyword">public</span> lastname<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">LoginRequest</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">public</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token keyword">public</span> password<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> User <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./user&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">UserResponse</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">public</span> user<span class="token operator">:</span> User<span class="token punctuation">,</span>
    <span class="token keyword">public</span> token<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">/* eslint-disable @typescript-eslint/naming-convention */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">public</span> id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span>
    <span class="token keyword">public</span> firstname<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token keyword">public</span> lastname<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token keyword">public</span> email<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token keyword">public</span> created_at<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
    <span class="token keyword">public</span> update_at<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><p>Prenez note du token dans la <code>UserResponse</code>, il servira à authentifier l&#39;utilisateur via l&#39;entête Authorization : <code>Authorization: Bearer &lt;token&gt;</code>. Apprenez-en plus sur les JWT <a href="https://jwt.io/introduction" target="_blank" rel="noopener noreferrer">ici<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><ol start="5"><li>Implémentez les méthodes <code>register</code> et <code>login</code> dans <code>AuthenticationService</code> comme suit :</li></ol><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">authentication.service.ts</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">private</span> <span class="token keyword">readonly</span> httpClient <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>HttpClient<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token keyword">readonly</span> baseUrl <span class="token operator">=</span> <span class="token string">&#39;api/user&#39;</span>
<span class="token keyword">private</span> <span class="token keyword">readonly</span> token <span class="token operator">=</span> <span class="token generic-function"><span class="token function">signal</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">null</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>

<span class="token function">login</span><span class="token punctuation">(</span>loginRequest<span class="token operator">:</span> LoginRequest<span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>UserResponse<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>httpClient<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span>UserResponse<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>baseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/login</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> loginRequest<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">tap</span><span class="token punctuation">(</span>response <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>token<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>token<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">register</span><span class="token punctuation">(</span>loginRequest<span class="token operator">:</span> LoginRequest<span class="token punctuation">)</span><span class="token operator">:</span> Observable<span class="token operator">&lt;</span>UserResponse<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> registrationRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegistrationRequest</span><span class="token punctuation">(</span>
    loginRequest<span class="token punctuation">.</span>email<span class="token punctuation">,</span>
    loginRequest<span class="token punctuation">.</span>password<span class="token punctuation">,</span>
    <span class="token string">&#39;John&#39;</span><span class="token punctuation">,</span>
    <span class="token string">&#39;Smith&#39;</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>httpClient<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span>UserResponse<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>baseUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/register</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> registrationRequest<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><ol start="6"><li>La modification de la signature d&#39;appel de la méthode <code>login</code> va nécessiter un peu de refactorisation dans le <code>LoginFormComponent</code> :</li></ol><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">login-form.component.ts</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">private</span> <span class="token keyword">readonly</span> router <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>Router<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token keyword">readonly</span> activatedRoute <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>ActivatedRoute<span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token keyword">readonly</span> authenticationService <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>AuthenticationService<span class="token punctuation">)</span>

<span class="token keyword">private</span> <span class="token keyword">readonly</span> loginRequest <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">LoginRequest</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">password</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>authenticationService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loginRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token function-variable function">next</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> postLoginRoute <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>activatedRoute<span class="token punctuation">.</span>snapshot<span class="token punctuation">.</span>queryParamMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;returnUrl&#39;</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">navigateByUrl</span><span class="token punctuation">(</span>postLoginRoute <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>postLoginRoute<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>authenticationService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loginRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><ol start="7"><li>Une refactorisation est également nécessaire pour que l&#39;<code>authenticationGuard</code> continue de fonctionner. Transformez la variable <code>loggedIn</code> dans l&#39;<code>AuthenticationService</code> en signal computed qui dépend du champ <code>token</code>. Refactorez aussi la méthode <code>logout()</code> pour qu&#39;elle remette la valeur du signal <code>token</code> à null.</li></ol><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">authentication.service.ts</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">readonly</span> loggedIn <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">token</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><!--]--></div><!--]--></div><ol start="8"><li>Ajoutez un bouton d&#39;enregistrement à côté du bouton de connexion dans le <code>LoginFormComponent</code>, donnez-lui l&#39;attribut <code>type=&quot;button&quot;</code> afin qu&#39;Angular sache que ce n&#39;est pas ce bouton qui déclenche l&#39;événement <code>ngSubmit</code> sur le formulaire et faites-lui appeler le méthode d&#39;enrôlement. Vous devriez maintenant pouvoir enregistrer un utilisateur et vous connecter. Si l&#39;enrôlement semble ne pas fonctionner, <strong>vérifiez l&#39;onglet network des outils de développement de votre navigateur</strong> (onglet preview de l&#39;appel réseau en erreur), votre mail ou mot de passe ne respectent peut-être pas les règles de validation du back.</li></ol><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">HTML</button></li><li class="code-group__li"><button class="code-group__nav-tab" ariapressed="false" ariaexpanded="false">SCSS</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Register<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Login<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><div class="code-group-item" aria-selected="false"><!--[--><div class="language-scss line-numbers-mode" data-ext="scss"><pre class="language-scss"><code><span class="token selector">.button-container </span><span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token property">justify-content</span><span class="token punctuation">:</span> space-between<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><ol start="9"><li>Il est temps de gérer les erreurs. La méthode subscribe peut prendre un objet qui propose trois callbacks: une <em>next</em>, une <em>error</em> et une <em>complete</em> (nous verrons cela plus en détail dans le chapitre suivant). Déclarer un signal <code>errorMessage</code> dans la classe <code>LoginFormComponent</code> et changer sa valeur en vous servant de l&#39;argument renvoyé par la callback <code>error</code>. Afficher le message d&#39;erreur sur le formulaire. Vérifier que le message d&#39;erreur s&#39;affiche bien lorsqu&#39;on saisit des identifiants incorrects.</li></ol><div class="code-group"><div class="code-group__nav"><ul class="code-group__ul"><li class="code-group__li"><button class="code-group__nav-tab code-group__nav-tab-active" ariapressed="true" ariaexpanded="true">login-form.component.ts</button></li></ul></div><!--[--><div class="code-group-item" aria-selected="false"><!--[--><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">protected</span> <span class="token keyword">readonly</span> errorMessage <span class="token operator">=</span> <span class="token function">signal</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">private</span> <span class="token function">errorHandler</span><span class="token punctuation">(</span>errorResponse<span class="token operator">:</span> HttpErrorResponse<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>errorMessage<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>errorResponse<span class="token punctuation">.</span>error<span class="token punctuation">.</span>error <span class="token operator">??</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>errorResponse<span class="token punctuation">.</span>error<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> - </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>errorResponse<span class="token punctuation">.</span>error<span class="token punctuation">.</span>statusText<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// subscribe syntax</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>authenticationService<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loginRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">next</span><span class="token operator">:</span> response <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* insérer du code ici */</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">error</span><span class="token operator">:</span> errorResponse <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* insérer du code ici */</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><!--]--></div><!--]--></div><div class="custom-container tip"><p class="custom-container-title">hint</p><p>Pour une meilleure UX (User eXperience), penser à vider le champ <code>errorMessage</code> soit avant de lancer une nouvelle requête d&#39;authentification ou d&#39;enregistrement, soit dès que celles-ci se terminent en succès.</p></div><ol start="10"><li>Appelons maintenant le backend pour obtenir la liste des films. La route est sécurisée, ce qui signifie que le passage du token dans l&#39;en-tête est nécessaire. Angular fournit un mécanisme - les intercepteurs http - pour intercepter systématiquement les requêtes http, permettant de définir les en-têtes en un seul endroit.</li></ol><p>a. Utilisez le CLI pour en générer un : <code>ng generate interceptor interceptors/authentication</code>.</p><p>b. Voici son implémentation :</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> HttpInterceptorFn <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@angular/common/http&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AuthenticationService <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;app/services/authentication.service&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> inject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@angular/core&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> authenticationInterceptor<span class="token operator">:</span> <span class="token function-variable function">HttpInterceptorFn</span> <span class="token operator">=</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token function">inject</span><span class="token punctuation">(</span>AuthenticationService<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">token</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> cloned <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      headers<span class="token operator">:</span> req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&#39;Authorization&#39;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>cloned<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>S&#39;il y a un token dans l&#39;<code>AuthenticationService</code>, l&#39;intercepteur l&#39;ajoutera aux en-têtes de la requête http.</p><p>c. Ajouter l&#39;intercepteur au provider de l&#39;<code>HttpClient</code> de l&#39;objet <code>appConfig</code>:</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token function">provideHttpClient</span><span class="token punctuation">(</span><span class="token function">withInterceptors</span><span class="token punctuation">(</span><span class="token punctuation">[</span>authenticationInterceptor<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="11"><li>Créez un <code>FilmService</code> à l&#39;aide du CLI et implémentez l&#39;appel au endpoint <code>api/movies/search</code>. Notez que le queryParam <code>title</code> n&#39;est pas facultatif. Pour ajouter des query params à une requête, utilisez le paramètre <code>options</code> de la méthode get.</li></ol><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  params<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">HttpParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&#39;title&#39;</span><span class="token punctuation">,</span> title<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="12"><li><p>Apportez des modifications au <code>FilmSearchComponent</code> pour appeler ce nouveau service avec le titre renseigné par l&#39;utilisateur, enregistrez la réponse dans le signal <code>films</code> de la classe <code>FilmSearchComponent</code>.</p></li><li><p>Vérifiez que le token est envoyé sous forme d&#39;en-tête HTTP via les outils de développement de votre navigateur.</p></li></ol><details class="custom-container details"><summary>Résultat attendu</summary><p><img src="/angular-training/assets/img/visual-7a.81fa3d56.png" alt="Résultat visuel du TP http"></p><p><img src="/angular-training/assets/img/visual-7b.2b988ec0.png" alt="Résultat visuel du TP http"></p></details><h2 id="aller-plus-loin-httpresource" tabindex="-1"><a class="header-anchor" href="#aller-plus-loin-httpresource" aria-hidden="true">#</a> Aller plus loin : HttpResource</h2><p>L&#39;<code>HttpClient</code> utilise les Observables de la librairie <code>rxjs</code>. Avoir deux modèles de réactivité (les Observables et les signaux) qui coexistent au sein du même framework peut sembler étrange. Les Observables sont présents depuis la première version d&#39;Angular et sont principalement rencontrés lors d&#39;appels réseaux ou d&#39;interactions avec les formulaires réactifs. Ils excellent dans des cas d&#39;utilisation réactifs complexes qui ne constituent pas la majeure partie de la base de code d&#39;une application Angular, mais qui sont essentiels au bon fonctionnement de votre application. Les signaux ne prendront pas le rôle des Observables car ils offrent une API moins puissante, toutefois ils remplaceront les Observables dans de nombreux cas plus simples. Un wrapper du <code>HttpClient</code> basé sur les signaux a été introduit en expérimental en Angular 19.2, le <code>HttpResource</code>. Vous pouvez explorer ses capacités <a href="https://angular.dev/guide/http/http-resource" target="_blank" rel="noopener noreferrer">ici<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. Il est conseillé de ne l’utiliser que pour les requêtes GET.</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/angular-training/fr/routing.html" class="" aria-label="Routage"><!--[--><!--]--> Routage <!--[--><!--]--></a></span><span class="next"><a href="/angular-training/fr/rxjs.html" class="" aria-label="RxJS"><!--[--><!--]--> RxJS <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/angular-training/assets/js/v-41615831.c02b75ba.js" defer></script><script src="/angular-training/assets/js/runtime~app.a825557b.js" defer></script><script src="/angular-training/assets/js/966.6bc1d20f.js" defer></script><script src="/angular-training/assets/js/app.2146f142.js" defer></script>
  </body>
</html>
